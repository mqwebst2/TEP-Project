import"../modulepreload-polyfill.c7c6310f.js";import{o as u}from"../index.783118d6.js";class d extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"}),s=document.querySelector("#comment-template").content.cloneNode(!0);t.append(s),this.name=this.shadowRoot.querySelector(".comment-title__name"),this.email=this.shadowRoot.querySelector(".comment-title__email"),this.message=this.shadowRoot.querySelector(".comment-body__message"),this.time=this.shadowRoot.querySelector(".comment-body__time")}static get observedAttributes(){return["name","email","message","time"]}attributeChangedCallback(t,s,e){s!==e&&this[`${t}`]&&(this[`${t}`].textContent=e)}}customElements.get("custom-comment")===void 0&&customElements.define("custom-comment",d);const l=u("comment-store",1,{upgrade(o){o.createObjectStore("comments",{keyPath:"id",autoIncrement:!0})}});class h{constructor(t={}){const s=this;this.subscribers=[],l.then(async e=>{this.db=e;const m=await e.getAll("comments");this.state.commentList=m,console.log(this.state.commentList)}),this.state=new Proxy(t,{async set(e,m,c){if(e[m]=c,s.db&&m==="commentList"){const n=c[c.length-1];n&&!(n!=null&&n.id)&&await s.db.add("comments",n)}for(const n of s.subscribers)n(e);return!0}})}subscribe(t){if(typeof t!="function")throw new Error("You must subscribe with a function.");this.subscribers.push(t),t(this.state)}addComment(t){t.date||(t.date=new Date().toLocaleString()),this.state.commentList.push(t),this.state.commentList=this.state.commentList}}const a=new h({commentList:[]}),b=document.querySelectorAll("[required]"),r=document.querySelector("#form"),i=document.querySelector("#output");for(const o of b)o.closest(".form-item").querySelector("label").classList.add("required");r.addEventListener("submit",o=>{o.preventDefault();const t=Object.fromEntries(new FormData(r).entries());console.log(t),a.addComment(t),o.target.reset(),o.target.querySelector("input").focus()});a.subscribe(o=>{const t=o.commentList;console.log(t),i.innerHTML="";for(const s of t){const e=document.createElement("custom-comment");e.setAttribute("name",s.name),e.setAttribute("email",s.email),e.setAttribute("message",s.comment),e.setAttribute("time",s.date),i.append(e)}});
